3.1 Installing and Configuring the Puppet Agent
-----------------------------------------------

Installing agent on centos and ubuntu
Tasks
1. Boot wiki and wikitest servers
2. Install and Configure Puppet Agent
3. Sign agent certificates

3.2 Lab Setup
-------------

1. Add the ubuntu box to Vagrant
2. Boot wiki and wikitest servers
3. Add Puppet Master to hosts file

3.3 Adding the Ubuntu Box to Vagrant
-----------------------------------
get the ubuntu box from github

Adding the Ubuntu Box to Vagrant
cd puppet-fundamentals-lab
vagrant box add trusty65 trusty-server-cloudimg-amd64-vagrant-disk1.box

3.4 Booting the wiki and wikitest servers
-----------------------------------------
#Booting the Ubuntu Server
Servername, wikitest

cd puppet-fundamentals-lab/wikitest
vagrant up

cd puppet-fundamentals-lab/wiki
vagrant up

3.5 Adding the Puppet Master to the Hosts file
----------------------------------------------
run the below commands on both wiki and wikitest servers

sudo -i
echo 172.31.0.201 puppetmaster >> /etc/hosts

3.6 Installing the Puppet Agent on CentOS
-----------------------------------------
sudo yum install http://yum.puppetlabs/puppetlabs-release-el-6.noarch.rpm
sudo yum install puppet

#install nano text editor
sudo yum -y install nano

#modify puppet configuration file to tell the puppet server
[agent]
  server = puppetmaster
#generating certificates
sudo puppet agent --verbose --no-daemonize --onetime

*************
Error:
[vagrant@wiki ~]$ sudo puppet agent --verbose --no-daemonize --onetime
Info: Creating a new SSL key for wiki
Error: Could not request certificate: Connection refused - connect(2)
Exiting; failed to retrieve certificate and waitforcert is disabled

Troubleshooting:
1. Disabled the iptables
#service iptables stop

to make it permanent:
#chkconfig iptables off

2. started the puppet service in puppetmaster
sudo service puppet start

Resolution:
sudo puppet resource service puppetmaster ensure=running
sudo puppet resource service puppetmaster enable=true

********************************************
3.7 Installing the Puppet Agent on Ubuntu
-----------------------------------------

wget https://apt.puppetlabs.com/puppetlabs-release-trusty.deb
sudo dpkg -i puppetlabs-release-trusty.deb
sudo apt-get update
sudo apt-get install puppet

#modify puppet configuration file to tell the puppet server
[agent]
  server = puppetmaster
#generating certificates
sudo puppet agent --verbose --no-daemonize --onetime

3.8 Signing Agent certificates
------------------------------
Certificate signing is done on the Puppet Master

sudo puppet cert list
sudo puppet cert sign wiki
sudo puppet cert sign wikitest

#Test the communication
#on wiki server
sudo puppet agent --verbose --no-daemonize --onetime

#on wikitest server
sudo puppet agent --verbose --no-daemonize --onetime

3.9 Summary
-----------
Puppet Agent
/etc/puppet/puppet.conf must be configured with the hostname of the Puppet Master

Puppet Master
signs the certificates generated by nodes












